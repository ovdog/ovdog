<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  <link href="/ven/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.useso.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/ven/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="ov智商捉急" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="你猜?">
<meta property="og:type" content="website">
<meta property="og:title" content="ov智商捉急">
<meta property="og:url" content="http://ovjaywang.github.io/page/3/index.html">
<meta property="og:site_name" content="ov智商捉急">
<meta property="og:description" content="你猜?">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ov智商捉急">
<meta name="twitter:description" content="你猜?">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> ov智商捉急 </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container one-collumn sidebar-position-left page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta custom-logo">
  
    <div class="site-meta-headline">
      <a>
        <img class="custom-logo-image" src="/images/touxiang.jpg" alt="ov智商捉急">
      </a>
    </div>
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ov智商捉急</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/me" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sth">
          <a href="/sth" rel="section">
            
              <i class="menu-item-icon fa fa-child fa-fw"></i> <br>
            
            有料
          </a>
        </li>
      
        
        <li class="menu-item menu-item-pic-movie">
          <a href="/a-pic-a-movie" rel="section">
            
              <i class="menu-item-icon fa fa-film fa-fw"></i> <br>
            
            一影一图
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input">
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'ZtWPUvzBjdXDQ7iNrTbW','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/10/后方交会检校(1)/" itemprop="url">
                  后方交会检校(1)--前景 共线方程及其线性化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-10T23:29:57+08:00" content="2015-10-10">
              2015-10-10
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/什么都学一下/" itemprop="url" rel="index">
                    <span itemprop="name">什么都学一下</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/什么都学一下/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/10/后方交会检校(1)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/10/后方交会检校(1)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>各种文档看得累。条理不清结构不明缺斤少两。决定自己总结一个。（公式较多，墙外浏览更顺哟）</p>
<p> 一些注意</p>
<p><strong>   后方交会是为了获取影像的内外方位数据，其中外方位数据可以通过GPS、INS（惯性导航系统）、雷达、星相摄像机来获取；然而由于穷穷穷，只能利用影响覆盖范围内的一定控制点来计算空间坐标与影响坐标之间的关系，来反算外方位元素。
</strong>   多片检校基于单片检校。在矩阵组合时分别解算外方位元素。但使用同一组内方位元素。在一个大矩阵内进行。<br><strong>   后方交会可以只检校外方位元素。当需要进行畸变差校正时（即畸变差不可忽略时），可在方程中加入畸变差项进行迭代；当需要进行内方位元素检校时（即内方位元素精度没有达到需求），可在方程中加入内方位元素进行迭代。
</strong>   对于畸变差校正，包括径向畸变、切向畸变、薄棱镜畸变，其中多数情况考察径向畸变的前两项系数k1 k2和切向畸变p1 p2 ，在某些组合相机的畸变模型中，还包括α像素非正方形比例和βccd非正交性畸变系数。<br><strong>   对于内方位元素检校，有的地方将f分为fx和fy即f在坐标两个方向上的像素值（由于有的xy不是同一比例尺即不是正方形）
</strong>   检校，就是纠正相机各个方面的误差和精度，可以得到相机内部的主点、焦距、畸变的客观信息，这些信息在大部分情况下不会轻易改变；而相机外部的空间位置时时刻刻都在改变，但一些论文指出，在焦距变化、空间位置变化、移轴、高空拍摄情况下，相机的焦距、主点位置也会随之或多或少的改变，因此迭代时最好能带上这些参数一起进行平差。</p>
<p><strong> 一些重要概念</strong><br>后方交会基于<span style="COLOR: #ff0000"><strong>共线方程</strong></span>，物理含义为同一个三维坐标系中投影中心、物方点、像平面投影的点在同一条直线上。</p>
<p> $$x-x_{0}=-f\cdot \frac{a_{1}(X-X_{s})+b_{1}(Y-Y_{s})+c_{1}(Z-Z_{s})}{a_{3}(X-X_{s})+b_{3}(Y-Y_{s})+c_{3}(Z-Z_{s})}$$</p>
<p> $$y-y_{0}=-f\cdot \frac{a_{2}(X-X_{s})+b_{2}(Y-Y_{s})+c_{2}(Z-Z_{s})}{a_{3}(X-X_{s})+b_{3}(Y-Y_{s})+c_{3}(Z-Z_{s})}$$</p>
<p> 上式中，包含留个外方位元素，即Xs、Ys、Zs、φ、Ω、k。只有确定了六个外方位元素，才能确定摄影中心在物方空间的位置。a1、a2、a3、b1、b2、b3、c1、c2、c3是需要计算的直线方程的系数，其物理性质是3个外方位角元素组成的9个方向余弦。该方程利用了相似三角形的性质；f是焦距长，X Y Z均值控制点的测量坐标，默认为精确的，因此物方控制点测量的精度很大程度上决定了最后检校的精度；x y是X Y Z对应的像平面的坐标，x0，y0是主点在像平面的坐标，有时当作已知并不再改变，有时也参与迭代计算。</p>
<p> 共线条件方程用途有：</p>
<ol>
<li>单像、多像空间后方交会；多像空间前方交会</li>
<li>解析空中三角测量的光束法平差</li>
<li>数字投影的基础</li>
<li>计算模拟影像数据（已知内外方位元素和物方坐标点求像点）</li>
<li>DEM与共线方程制作正射影像</li>
<li>DEM与共线方程进行单幅影像测图</li>
</ol>
<blockquote>
<p><strong>注意 一个方程代表一个点在像平面和物方世界的关系，因此一个点对应两个方程，若有n个控制点，则对应2n个方程</strong></p>
</blockquote>
<p> 若f x0 y0当作已知，则有外方位元素6个未知数，因此需要6个方程，即3个控制点的方程；若f x0 y0当作未知，则有9个未知数，因此需要至少5个控制点的方程。当然，很多文章也指出，<strong>越多的冗余数据</strong>参与计算得到的结果也越精确；<strong>越多的像片</strong>参与计算，得到的结果越精确；<strong>更均匀的控制点分布</strong>，能更多的控制整张像片，均匀的分布在边缘，得到的结果更精确。</p>
<p> 一般情况下，令<br> $$\overline{X}=a_{1}(X-X_{s})+b_{1}(Y-Y_{s})+c_{1}(Z-Z_{s})$$</p>
<p>$$\overline{Y}=a_{2}(X-X_{s})+b_{2}(Y-Y_{s})+c_{2}(Z-Z_{s})$$</p>
<p>$$\overline{Z}=a_{3}(X-X_{s})+b_{3}(Y-Y_{s})+c_{3}(Z-Z_{s})$$</p>
<p> 而用矩阵的形式可以表示为：</p>
<p> $$\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix}=\begin{pmatrix}a_{1}&amp;b_{1}&amp;c_{1}\\a_{2}&amp;b_{2}&amp;c_{2}\\a_{3}&amp;b_{3}&amp;c_{3}\end{pmatrix}\cdot\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}=R^{T}\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}$$</p>
<p>这里R是旋转矩阵，且$R^{T}=R^{-1}$,行列式的值为0，即任意元素等于其代数余子式的值.则共线方程变为：</p>
<p> $$x-x_{0}=-f\cdot \frac{\overline{X}}{\overline{Z}},y-y_{0}=-f\cdot \frac{\overline{Y}}{\overline{Z}}$$</p>
<p> 由于上式是共线方程的变形，因此Fx和Fy是六个外方位元素为参数的函数。由于方程是非线性的，因此不能解求数值，<strong>需要对方程进行线性化</strong>。思路是，对上式按泰勒级数在初值处展开并保留一次项，将非线性方程转化为各参数<span style="COLOR: #ff0000"><strong>改正数</strong></span>的线性方程</p>
<p> 设<span style="COLOR: #ff0000">初值</span>为$$X_{S}^{0},X_{S}^{0},Z_{S}^{0},\varphi^{0},\omega^{0},\kappa {0},X^{0},Y^{0},Z^{0},x_{0}^{0},y_{0}^{0},f^{0}$$</p>
<p> 相应的<span style="COLOR: #ff0000">改正数</span>为</p>
<p> $$dXs=\triangle Xs=Xs-Xs^{0},dYs=\triangle Ys=Ys-Ys^{0},dZs=\triangle Zs=Zs-Zs^{0}$$</p>
<p> $$d\varphi=\triangle \varphi=\varphi-\varphi^{0},d\omega=\triangle \omega=\omega-\omega^{0},d\kappa=\triangle \kappa=\kappa-\kappa^{0}$$</p>
<p> $$dX=\triangle X=X-X^{0},dY=\triangle Y=Y-Y^{0},dZ=\triangle Z=Z-Z^{0}$$</p>
<p> &nbsp;则<font color="#FF0000" size="5">共线方程的泰勒一次展开一般式</font>为<font color="#FF0000" size="5">①</font></p>
<p> $$x=(x)+\frac{\partial x}{\partial Xs}dXs+\frac{\partial x}{\partial Ys}dYs+\frac{\partial x}{\partial Zs}dZs+\frac{\partial x}{\partial \varphi }d\varphi +\frac{\partial x}{\partial \omega }d\omega +\frac{\partial x}{\partial \kappa }d\kappa +\frac{\partial x}{\partial X}dX+\frac{\partial x}{\partial Y}dY+\frac{\partial x}{\partial x_{0}}dx_{0}+\frac{\partial x}{\partial y_{0}}dy_{0}+\frac{\partial x}{\partial f}df$$</p>
<p>$$y=(y)+\frac{\partial y}{\partial Xs}dXs+\frac{\partial y}{\partial Ys}dYs+\frac{\partial y}{\partial Zs}dZs+\frac{\partial y}{\partial \varphi }d\varphi +\frac{\partial y}{\partial \omega }d\omega +\frac{\partial y}{\partial \kappa }d\kappa +\frac{\partial y}{\partial X}dX+\frac{\partial y}{\partial Y}dY+\frac{\partial y}{\partial x_{0}}dx_{0}+\frac{\partial y}{\partial y_{0}}dy_{0}+\frac{\partial y}{\partial f}df$$</p>
<p>这是一个重要的总结性公式。(x)(y)分别是内方位元素x，y的初值。式中包含了所有内外元素和物放测量点。当进行不同矩阵运算时，可以选择需要的精度不足够的进行迭代计算。</p>
<p>其中，对x和y求各未知项的偏导：</p>
<p> $$\frac{\partial x}{\partial Xs}=-f\cdot \frac{\frac{\partial \overline{X}}{\partial Xs}\overline{Z}-\frac{\partial \overline{Z}}{\partial Xs}\overline{X}}{\overline{Z}^{2}}=-\frac{f}{\overline{Z}^{2}}(-a_{1}\overline{Z}+a_{3}\overline{X})=\frac{1}{\overline{Z}}[a_{1}f-a_{3}f\frac{\overline{X}}{\overline{Z}}]=\frac{1}{\overline{Z}}[a_{1}f+a_{3}(x-x_{0})]$$</p>
<p> 同理，其他的偏导为</p>
<p> $$\begin{align}<br> \frac{\partial x}{\partial Ys} &amp; =\frac{1}{\overline{Z}}[b_{1}f+b_{3}(x-x_{0})] \\<br> \frac{\partial x}{\partial Zs} &amp; =\frac{1}{\overline{Z}}[c_{1}f+b_{3}(x-x_{0})] \\<br> \frac{\partial y}{\partial Xs} &amp; =\frac{1}{\overline{Z}}[a_{2}f+a_{3}(x-x_{0})] \\<br> \frac{\partial y}{\partial Ys} &amp; =\frac{1}{\overline{Z}}[b_{2}f+b_{3}(x-x_{0})] \\<br> \frac{\partial y}{\partial Zs} &amp; = \frac{1}{\overline{Z}}[c_{2}f+c_{3}(x-x_{0})] \\<br>\frac{\partial x}{\partial f} &amp; =\frac{x-x_{0}}{f}=-\frac{\overline{X}}{\overline{Z}} \\<br>\frac{\partial y}{\partial f} &amp; =\frac{y-y_{0}}{f}=-\frac{\overline{Y}}{\overline{Z}} \\<br>\frac{\partial x}{\partial x_{0}} &amp; =1,\frac{\partial x}{\partial y_{0}}=0\\<br>\frac{\partial y}{\partial x_{0}} &amp; =0,\frac{\partial y}{\partial y_{0}}=1<br>\end{align}$$</p>
<p> 这里相对比较难解决的是角元素的偏导，关于角度的问题可以参考第三篇。</p>
<p> 角度的变换在这里不再详述，两个坐标系之间的转换可以归结为变换矩阵的求取。三个角元素共同构成了矩阵的元素确定。 由于</p>
<p>$$R^{T}=R_{\kappa }^{T}R_{\omega }^{T}R_{\varphi }^{T} $$</p>
<p>因而，难度转到求取$\overline{X}\overline{Y} \overline{Z} $对角元素的偏导上。对角元素求偏导可以分为三个步骤：</p>
<p>①求各个方向余弦$a_{i},b_{i},c_{i}$对ω、k、φ的偏导数。共27个。</p>
<p>②求$\overline{X},\overline{Y},\overline{Z}$对ω、k、φ的偏导数，共9个。</p>
<p>③求x、y对ω、k、φ的偏导数，共6个。</p>
<p>如下是$\overline{X},\overline{Y},\overline{Z}$对φ的偏导，三个参数写在矩阵中，有的地方也展开写成每一项的等式形式。</p>
<p>$$\begin{align}<br>\frac{\partial }{\partial \varphi }\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix}&amp;=R_{\kappa }^{T}R_{\omega }^{T}\frac{\partial R_{\varphi }^{T}}{\partial \varphi }\begin{pmatrix}X-Xs\ Y-Ys\ Z-Zs\end{pmatrix}=R_{\kappa }^{T}R_{\omega }^{T}\frac{\partial R_{\varphi }^{T}}{\partial \varphi }(R^{T})^{-1}\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}=R_{\kappa }^{T}R_{\omega }^{T}\frac{\partial R_{\varphi }^{T}}{\partial \varphi }R\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}\\\ &amp;=R_{\kappa }^{T}R_{\omega }^{T}(R_{\varphi }^{T}R_{\varphi })\frac{\partial R_{\varphi }^{T}}{\partial \varphi }R\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}=R^{T}R_{\varphi }\frac{\partial R_{\varphi }^{T}}{\partial \varphi }R\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}<br>\end{align}$$</p>
<p>带入具体系数，上式可变形为<br>$$<br>\begin{matrix}<br>\begin{pmatrix}a_{1} &amp; b_{1} &amp; c_{1}\\a_{2} &amp; b_{2} &amp; c_{2}\\a_{3} &amp; b_{3} &amp; c_{3}\end{pmatrix}\begin{pmatrix}0 &amp; 0 &amp;1\\0 &amp; 0 &amp; 0\\\ -1 &amp; 0 &amp; 0\end{pmatrix}\begin{pmatrix}a_{1} &amp; a_{2} &amp; a_{3}\\b_{1} &amp; b_{2} &amp; b_{3}\\c_{1} &amp; c_{2}&amp;c_{3} \end{pmatrix}\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z} \end{pmatrix}\\<br>=\begin{pmatrix}0 &amp;-a_{2}c_{1}+a_{1}c_{2}&amp;-a_{3}c_{1}+a_{1}c_{3}\\\ -a_{1}c_{2}+a_{2}c_{1} &amp; 0 &amp; -a_{3}c_{2}+a_{2}c_{3}\\\ -a_{1}c_{3}+a_{3}c_{1}&amp; -a_{2}c_{3}+a_{3}c_{2} &amp;0\end{pmatrix}\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z} \end{pmatrix} \\<br>= \begin{pmatrix}0 &amp; -b_{3} &amp; b_{2}\\b_{3}&amp;0&amp;-b_{1}\\\ -b_{2}&amp;b_{1}&amp;0\end{pmatrix}\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z} \end{pmatrix}<br>\end{matrix}<br>$$<br>其中利用了旋转矩阵一个元素的值<font color="#FF0000">等于代数余子式的值</font>。如下是$\overline{X},\overline{Y},\overline{Z}$对ω的偏导。</p>
<p>$$\begin{align}<br>\frac{\partial }{\partial \omega }\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix} &amp;=R_{\kappa }^{T}\frac{\partial R_{\omega}^{T}}{\partial \omega }R_{\varphi }^{T}\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}=R_{\kappa}^{T}\frac{\partial R_{\omega }^{T}}{\partial \omega }R_{\varphi }^{T}(R_{\varphi }R_{\omega }R_{\kappa })\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix}\\<br>&amp;=R_{\kappa }^{T}\frac{\partial R_{\omega }^{T}}{\partial \omega}R_{\omega }R_{\kappa }\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}=<br>\begin{pmatrix}0&amp;0&amp;sin\kappa\\\ 0&amp;0&amp;cos\kappa \\\ -sin\kappa&amp;-cos \kappa&amp;0\end{pmatrix}\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}<br>\end{align}$$其中，这里用到了</p>
<p>$$\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix}=R^{T}\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}=(R_{\varphi}R_{\omega}R_{\kappa })^{T}\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}=R_{\kappa }^{T}R_{\omega }^{T}R_{\varphi }^{T}\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}$$</p>
<p>$$\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}=(R^{T})^{-1}\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix}=R\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix}=R_{\varphi }R_{\omega }R_{\kappa }\begin{pmatrix}\overline{X}\\\overline{Y}\\\overline{Z}\end{pmatrix}$$</p>
<p>如下是$\overline{X},\overline{Y},\overline{Z}$对k的偏导。</p>
<p>$$\begin{align}<br>\frac{\partial }{\partial \kappa }\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}&amp;=\frac{\partial R_{\kappa }^{T}}{\partial \kappa }R_{\omega }^{T}R_{\varphi }^{T}\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}\\&amp;=\frac{\partial R_{\kappa }^{T}}{\partial \kappa }(R_{\kappa }R_{\kappa }^{T})R_{\omega }^{T}R_{\varphi }^{T}\begin{pmatrix}X-Xs\\Y-Ys\\Z-Zs\end{pmatrix}\\<br>&amp;=\frac{\partial R_{\kappa }^{T}}{\partial \kappa }R_{\kappa }\begin{pmatrix}\overline{X}\ \overline{Y}\ \overline{Z}\end{pmatrix}=\begin{pmatrix}\overline{Y} \\\- \overline{X}\\0\end{pmatrix}<br>\end{align}$$<br> 通过以上三式可得到x和y对各角元素未知数的偏导。有的地方，将x，y先分别除以$\overline{Z}$,这样可以在求取偏导的时候减少计算量。<br>$$<br>\begin{align}<br>\frac{\partial x}{\partial \varphi}<br>&amp; = -\frac{f}{\overline{Z}^{2}}(\frac{\partial \overline{X}}{\partial \varphi }\overline{Z}-\frac{\partial \overline{Z}}{\partial \varphi }\overline{X}) \\<br> &amp; = -\frac{f}{\overline{Z}^{2}}(-b_{3}\overline{Y}+b_{2}\overline{Z})\overline{Z}+\frac{f}{\overline{Z}^{2}}(b_{2}\overline{X}-b_{1}\overline{Y})\overline{X} \\<br>  &amp; = -(y-y_{0})b_{3}-fb_{2}-\frac{(x-x_{0})^{2}}{f}b_{2}+\frac{(x-x_{0})(y-y_{0})}{f}b_{1} \\<br> &amp; = \frac{(x-x_{0})(y-y_{0})}{f}b_{1}-(f+\frac{(x-x_{0})^{2}}{f})b_{2}-(y-y_{0})b_{3}<br>\end{align}<br>$$<br>其他以此类推<br>$$<br>\begin{align}<br>\frac{\partial x}{\partial \omega } &amp;=<br>\frac{(x-x_{0})^{2}}{f}sin\kappa-\frac{(x-x_{0})(y-y_{0})}{f}cos\kappa -fsin\kappa \\\ <br>\frac{\partial x}{\partial \kappa } &amp;=<br>(f+\frac{(y-y_{0}^{2})}{f})b_{1}-\frac{(x-x_{0})(y-y_{0})}{f}b_{2}-(x-x_{0})b_{3} \\<br>\frac{\partial y}{\partial \omega } &amp;=<br>-\frac{(x-x_{0})(y-y_{0})}{f}sin\kappa -\frac{(y-y_{0})^{2}}{f}cos\kappa -fcos\kappa \\<br>\frac{\partial y}{\partial \kappa }&amp;=-(x-x_{0})<br>\end{align} $$<br>以上求出了所有的偏导，则①式的公式可变为<font color="#FF0000" size="5">更重要的</font>式<font color="#FF0000">②</font></p>
<p>$$\begin{aligned}<br>c_{11}dXs+c_{12}dYs+c_{13}dZs+c_{14}d\phi +c_{15}d\omega &amp;+c_{16}d\kappa \\\ -c_{11}dX &amp;-c_{12}dY-c_{13}dZ+c_{17}df+c_{18}dx_{0}+c_{19}dy_{0}-lx=0<br>\end{aligned}$$<br>$$\begin{aligned}<br>c_{21}dXs+c_{22}dYs+c_{23}dZs+c_{24}d\phi +c_{25}d\omega &amp;+c_{26}d\kappa \\\ -c_{21}dX &amp;-c_{22}dY-c_{23}dZ+c_{27}df+c_{28}dx_{0}+c_{29}dy_{0}-ly=0<br>\end{aligned}$$<br>这里可以看到，Xs和X Ys和Y Zs和Z的偏导互为相反数，因此12个未知数只需要求解9个。 其中c的系数分别为：<br>$$\begin{align}<br>c_{11}&amp; = \frac{1}{\overline{Z}}(a_{1}f+a_{3}(x-x_{0})) \\<br>c_{12}&amp; = \frac{1}{\overline{Z}}(b_{1}f+b_{3}(x-x_{0})) \\<br>c_{13}&amp; = \frac{1}{\overline{Z}}(c_{1}f+c_{3}(x-x_{0})) \\<br>c_{14}&amp; = \frac{(x-x_{0})(y-y_{0})}{f}b_{1}-(f+\frac{(x-x_{0})^{2}}{f})b_{2}-(y-y_{0})b_{3} \\<br>c_{15}&amp; = -\frac{(x-x_{0})^{2}}{f}sin\kappa -\frac{(x-x_{0})(y-y_{0})}{f}cos\kappa -fsin\kappa \\<br>c_{16}&amp; = y-y_{0}\\<br>c_{17}&amp; = \frac{x-x_{0}}{f},c_{18}=1,c_{19}=0,lx=x-x_{cal}\\<br>c_{21} &amp;= \frac{1}{\overline{Z}}(a_{2}f+a_{3}(y-y_{0}))\\<br>c_{22} &amp;= \frac{1}{\overline{Z}}(b_{2}f+b_{3}(y-y_{0}))\\<br>c_{23} &amp;= \frac{1}{\overline{Z}}(c_{2}f+c_{3}(y-y_{0}))\\<br>c_{24} &amp;= (f+\frac{(y-y_{0})^{2}}{f})b_{1}-\frac{(x-x_{0})(y-y_{0})}{f}b_{2}+(x-x_{0})b_{3}\\<br>c_{25} &amp;= -\frac{(x-x_{0})(y-y_{0})}{f}sin\kappa -\frac{(y-y_{0})^{2}}{f}cos\kappa -fcos\kappa \\<br>c_{26} &amp;= -(x-x_{0})\\<br>c_{27}&amp;=\frac{y-y_{0}}{f},c_{28}=0,c_{29}=1,ly=y-y_{cal}\end{align} $$</p>
<p>在正摄影像近似垂直时，可以采用φ≈ω≈k≈0,$\overline{Z}\approx -H$的取值带入系数中，则②式可化简为<font color="#FF0000">本篇最终的结果式③</font>：</p>
<p>$$\left\{\begin{matrix}v_{x}=-\frac{f}{H}dXs-\frac{x-x_{0}}{H}dZs-[f+\frac{(x-x_{0})^{2}}{f}]d\varphi-\frac{(x-x_{0})(y-y_{0})}{f}d\omega+(y-y_{0})d\kappa+\frac{f}{H}dX+\frac{x-x_{0}}{H}dZ+\frac{x-x_{0}}{f}df+dx_{0}-(x-x_{cal})\\v_{y}=-\frac{f}{H}dYs-\frac{y-y_{0}}{H}dZs-\frac{(x-x_{0})(y-y_{0})}{f}d\varphi-[f+\frac{(y-y_{0})^{2}}{f}]d\omega+(x-x_{0})d\kappa+\frac{f}{H}dY+\frac{y-y_{0}}{H}dZ+\frac{y-y_{0}}{f}df+dy_{0}-(y-y_{cal})\end{matrix}\right.$$</p>
<p>式中相对①式添加了改正项，为了平衡一次项以下的展开式对结果的影响，是平差方程中重要的一部。误差方程将在下文提到。</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/09/红包在哪里/" itemprop="url">
                  红包在哪里
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-09T02:16:05+08:00" content="2015-10-09">
              2015-10-09
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/槽/" itemprop="url" rel="index">
                    <span itemprop="name">槽</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/09/红包在哪里/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/09/红包在哪里/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在 2015 年这一年，这种从相杀到相爱的事情已经发生了三次：<br>2015 年 2 月 14 日，滴滴和快的宣布合并；<br>2015 年 4 月 17 日，58 与赶集宣布合并；<br>2015 年 10 月 8 日，美团与大众点评宣布合并。</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/21/一个装机清单/" itemprop="url">
                  一个装机清单
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-06-21T16:36:25+08:00" content="2015-06-21">
              2015-06-21
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/App强推/" itemprop="url" rel="index">
                    <span itemprop="name">App强推</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/App强推/软文/" itemprop="url" rel="index">
                    <span itemprop="name">软文</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/06/21/一个装机清单/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/06/21/一个装机清单/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>分享一个装机<a href="https://qdan.me/list/VYA83-njGa_t4EkD" target="_blank" rel="external">清单</a>。</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/30/最近听的音乐/" itemprop="url">
                  最近听的音乐
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-30T18:10:51+08:00" content="2015-05-30">
              2015-05-30
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/槽/" itemprop="url" rel="index">
                    <span itemprop="name">槽</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/30/最近听的音乐/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/30/最近听的音乐/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天。听李志和陈粒</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/12/sift-with-python/" itemprop="url">
                  记录一次心酸而无终的悲催却又惊喜的Python添加sift类库过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-12T17:17:45+08:00" content="2015-05-12">
              2015-05-12
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/" itemprop="url" rel="index">
                    <span itemprop="name">代码狗</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/12/sift-with-python/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/12/sift-with-python/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>基于上回对Harris的角点检测和匹配的过程，试想这学习一下另一种角点检测和匹配算法sift.<br>在《Python计算机视觉》书中，由于Python实现所有步骤的效率并不是很高，提到了VLFeat工具进行SIFT兴趣点的检测。</p>
<p>好的，那就去<a href="http://www.vlfeat.org/" target="_blank" rel="external">官网</a>找。它明确写着Windows Mac Linux都可用。太好了。但是主要提供的是c 和 MATLAB 的api，在python中只能利用shell进行接口的调用。将目录下的\bin\arch\sift.exe 添加到path环境路径，就能在cmd控制台使用shell。可是测试了几次，依据<a href="http://www.vlfeat.org/man/sift.html#EXAMPLES" target="_blank" rel="external">例子</a>或者普林斯顿的<a href="http://vision.cs.princeton.edu/pvt/SiftFu/SiftFu/SIFTransac/vlfeat/doc/man/sift.html" target="_blank" rel="external">抄袭版本</a>，都只能打开可视化的界面，不能输入需要的.sift或者frame图像。</p>
<p>好吧换个方案，听说Python有一个包装器。找到了供github下的<a href="https://github.com/mmmikael/vlfeat/tree/python-wrappers/python" target="_blank" rel="external">pyhton wrappers主页</a>（居然是寄生在MATLAB的插件下面）可是。。可是。在它的readme发现只能在linux和Mac OX使用。。书中亦提到包装器的安装需要非常高的技巧。好吧放弃。</p>
<p>再次寻找。发现一个python官网提供的一个<a href="https://pypi.python.org/pypi/pyvlfeat" target="_blank" rel="external">python插件</a>。直接可以利用setup.py insatll进行安装。好了进行安装</p>
<pre class="brush: shell; gutter: true">python setup.py install
</pre>

<p>居然出现了bug</p>
<pre class="brush: shell; gutter: true">Unable to find vcvarsall.bat
</pre>

<p>找到一些<a href="http://stackoverflow.com/questions/2817869/error-unable-to-find-vcvarsall-bat" target="_blank" rel="external">讨论</a>，大家都说是要安MinGW，找到它的官网，<a href="http://sourceforge.net/projects/mingw/files/Installer/" target="_blank" rel="external">这个</a>看起来不错。默认选择了安装路径，又安装了一堆.bin 的类库。输入</p>
<pre class="brush: shell; gutter: true">setup.py install build --compiler=mingw32
</pre>

<p>又出现了bug</p>
<pre class="brush: shell; gutter: true">error: numpy/arrayobject.h: No such file or directory
</pre>

<p>日了狗了。在<a href="http://stackoverflow.com/questions/14657375/cython-fatal-error-numpy-arrayobject-h-no-such-file-or-directory" target="_blank" rel="external">这里</a>说需要加点什么路径，然后又在<a href="http://stackoverflow.com/questions/14657375/cython-fatal-error-numpy-arrayobject-h-no-such-file-or-directory" target="_blank" rel="external">这里</a>发现了说是它的mingw已经很旧了不太能匹配新的版本的软件了。可以找到一个<a href="https://github.com/develersrl/gccwinbinaries" target="_blank" rel="external">非官方版本</a>。</p>
<p>好吧。开心的安上。再一次安了gcc等一系列乱七八糟的bin库。然后执行。。。shit。又是bug arraypobjects.h又找不到。。</p>
<p>好吧超出了我的技能点了。顺带在半路还捡到一个非官方的python类库，叫做<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="external">unofficial windows binaries for python extention package</a><br>..</p>
<p>正在绝望之时。。居然在csdn发现了这本书的<a href="http://download.csdn.net/detail/shidecai1230/8255391#comment" target="_blank" rel="external">源代码</a>oh wtf。居然它的自带vlfeat能用。好吧到此结束了。直接用命令行好了。py中利用</p>
<pre class="brush: python; gutter: true">os.system(&#039;cmd&#039;)</pre>

<p>使用命令行进行编写。</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/12/python角点检测及生成exe/" itemprop="url">
                  Python角点检测及生成exe
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-12T01:48:13+08:00" content="2015-05-12">
              2015-05-12
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/" itemprop="url" rel="index">
                    <span itemprop="name">代码狗</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/12/python角点检测及生成exe/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/12/python角点检测及生成exe/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #000000">最近学习计算机视觉，初步学习了特征点的几个算子和描述子，最初级的是Harris和进阶的SIFT.囿于最近又想学python所以弄了一下它的数值计算的库scipy numpy和图形界面的库PIL和matplotlib..具体环境是：</span></p>
<ol>
<li><span style="color: #000000">1python环境的搭建有两种方式，可以使用官方的<a href="https://www.python.org/downloads/" target="_blank" rel="external">Python2.79</a> 搭配上Enthought提供的一个轻量Free版本<a href="https://store.enthought.com/downloads/#default" target="_blank" rel="external">canopy</a>供学习和开发者使用（包括<strong>NumPy, SciPy, Pandas, Matplotlib, IPython</strong>）；或者直接使用<a href="http://scipy.org/install.html" target="_blank" rel="external">Scipy官网</a>推荐使用的Python其他搭载了Numpu和Scipy的发行版，我体验了Python(x,y)效果还是不错的</span></li>
<li><span style="color: #000000">PIL图像库，可在其<a href="http://www.pythonware.com/products/pil/#" target="_blank" rel="external">官网</a>下载最新版本1.1.7的PIL（虽然已经是2009年。。目前只支持2.X可在WIn LInux OX平台使用）</span></li>
<li><span style="color: #000000">Matplotlib在安装Numpy和Scipy时应该已经提供，若没有下载完成则可在其<a href="http://matplotlib.sourceforge.net/" target="_blank" rel="external">网站</a>免费获取</span></li>
</ol>
<h2 id="Harris特征检测"><a href="#Harris特征检测" class="headerlink" title="Harris特征检测"></a><strong><span style="color: #000000">Harris特征检测</span></strong></h2><p><span style="color: #000000">安装完成后就可以进行Python图形可视化的编写。首先对Harris角点检测算法有个介绍。主要思想是，<span style="color: #ff0000">如果像素周围存在多于一个方向的边，认为该点就是兴趣点，称为角点。</span></span></p>
<p><span style="color: #000000"><span style="color: #ff0000">角点的定义是：局部窗口沿各方向运动，均产生明显变化的点；图像局部曲率突变的点。<span style="color: #000000">窗口函数可以选择创体内1窗体外0，或者高斯函数。窗口移动导致的图像变化可利用实对称矩阵的特征值分析，计算各角点的响应。其中一种方式是，利用最大的特征值进行判断，对特征值均非常大的，表述为各方向上变化均非常大；对特征值均非常小的，表述为各方向上无明显变化；若一个特征值大一个特征值小，则判定为边缘。另一种方法是，利用响应函数det (H)−αtrace(H)^2 或者λ0λ1/(λ0+λ1)。最后，利用阈值筛选出局部极大值。该算法具有光照不变性，旋转不变性，对比度部分不变。尺度变换不具有不变性。</span></span></span></p>
<pre class="brush: shell; gutter: true">from scipy.ndimage import filters
from PIL import Image
from numpy import *
from pylab import *

def compute_harris_response(im,sigma=3):
#计算harris响应函数
imx = zeros(im.shape)
filters.gaussian_filter(im,(sigma,sigma),(0,1),imx)
imy = zeros(im.shape)
filters.gaussian_filter(im,(sigma,sigma),(1,0),imy)

Wxx = filters.gaussian_filter(imx*imx,sigma)
Wxy = filters.gaussian_filter(imx*imy,sigma)
Wyy = filters.gaussian_filter(imy*imy,sigma)

Wdet = Wxx*Wyy - Wxy**2
Wtr = Wxx +Wyy

return Wdet / Wtr

def get_harris_points(harrisim,min_dist,threshold):

corner_threshold = harrisim.max() * threshold
harrisim_t = (harrisim &gt; corner_threshold) * 1

coords =array(harrisim_t.nonzero()).T

candidate_values = [harrisim[c[0],c[1]] for c in coords]

index = argsort(candidate_values)

allowed_locations = zeros(harrisim.shape)
allowed_locations[min_dist:-min_dist,min_dist:-min_dist]=1

filtered_coords = []
for i in index:
if allowed_locations[coords[i,0],coords[i,1]] == 1:
filtered_coords.append(coords[i])
allowed_locations[(coords[i,0]-min_dist):(coords[i,0]+min_dist),(coords[i,1]-min_dist):(coords[i,1]+min_dist)] = 0
return filtered_coords

def plot_harris_points(im1,im2,filtered_coords1,filtered_coords2):
figure()
gray()
im=concatenate((im1,im2),axis=1)
imshow(im)
shp1 = im1.shape[1]
for j in filtered_coords2:
jj = [j[0] , j[1] +shp1]
filtered_coords1.append(jj)
plot([p[1] for p in filtered_coords1],[p[0] for p in filtered_coords1],&#039;*&#039;)
axis(&#039;off&#039;)
show()

im01= array(Image.open(&#039;1.JPG&#039;))
im02= array(Image.open(&#039;2.JPG&#039;))
im1 = array(Image.open(&#039;1.JPG&#039;).convert(&#039;L&#039;))
im2 = array(Image.open(&#039;2.JPG&#039;).convert(&#039;L&#039;))
harrisim1 = compute_harris_response(im1)
harrisim2 = compute_harris_response(im2)
min_dist=7
threshold=0.05
filtered_coords1 = get_harris_points(harrisim1,min_dist,threshold)
filtered_coords2 = get_harris_points(harrisim2,min_dist,threshold)
print len(filtered_coords1)
print len(filtered_coords2)
plot_harris_points(im01,im02,filtered_coords1,filtered_coords2)

其中1.jpg和2.jpg可换成自己的图像。函数说明在注释中已说明。</pre>

<p><img src="http://7xlk6q.com1.z0.glb.clouddn.com/harris.PNG" alt=""></p>
<p>## </p>
<h2 id="harris特征匹配"><a href="#harris特征匹配" class="headerlink" title="harris特征匹配"></a><strong>harris特征匹配</strong></h2><p><span style="color: #000000">角点检测器只能检测图像中的兴趣点，但是没有给出匹配角点的方法，这里需要对每个角点加上描述子信息，即角点周围的点的信息。描述子描述越好，寻找匹配对应点越好。Harris角点的描述子又周围像素块的灰度值以及用于比较归一化互相关矩阵构成。通常两个相同大小像素块的相关矩阵定义为函数f对像素块卷积的和。归一化互相关矩阵的一种变形可以定义为：</span></p>
<p><img src="http://7xlk6q.com1.z0.glb.clouddn.com/ncc自相关矩阵.PNG" alt=""></p>
<p><span style="color: #ff0000">其中，n表示像素块的数目，μ1和μ2表示每个像素块平均像素强度，σ1和σ2表示每个像素块的标准差。通过减去均值和标准差，该方法对图像亮度变化具有稳健性。</span></p>
<pre class="brush: shell; gutter: true">#_*_encoding:utf-8_*_
from scipy.ndimage import filters
from PIL import Image
from numpy import *
from pylab import *&lt;/code&gt;

def compute_harris_response(im,sigma=3):
#计算灰度图像中harris角点响应函数

#计算导数
imx = zeros(im.shape)
filters.gaussian_filter(im,(sigma,sigma),(0,1),imx)
imy = zeros(im.shape)
filters.gaussian_filter(im,(sigma,sigma),(1,0),imy)
#计算harris矩阵分量
Wxx = filters.gaussian_filter(imx*imx,sigma)
Wxy = filters.gaussian_filter(imx*imy,sigma)
Wyy = filters.gaussian_filter(imy*imy,sigma)
#计算特征值和迹
Wdet = Wxx*Wyy - Wxy**2
Wtr = Wxx +Wyy

return Wdet / Wtr

def get_harris_points(harrisim,min_dist,threshold):
#得到harris特征点集 harrisim是计算harris响应函数的灰度图像 min_dist为分割角点和图像边界最少像素数

#寻找高于阈值的候选点
corner_threshold = harrisim.max() * threshold
harrisim_t = (harrisim &amp;gt; corner_threshold) * 1
#得到候选点的坐标
coords =array(harrisim_t.nonzero()).T
#计算候选点响应值
candidate_values = [harrisim[c[0],c[1]] for c in coords]
#对候选点按照响应值进行排序
index = argsort(candidate_values)
#将可行点的位置保存到数组
allowed_locations = zeros(harrisim.shape)
allowed_locations[min_dist:-min_dist,min_dist:-min_dist]=1
#按照min_distance原则选择最佳Harris点
filtered_coords = []
for i in index:
if allowed_locations[coords[i,0],coords[i,1]] == 1:
filtered_coords.append(coords[i])
allowed_locations[(coords[i,0]-min_dist):(coords[i,0]+min_dist),(coords[i,1]-min_dist):(coords[i,1]+min_dist)] = 0
return filtered_coords

def get_descriptors(image,filtered_coords,wid):
#对返回的坐标点，获取2*wid+1个像素的值，即获取harris描述
desc=[]
for coords in filtered_coords:
patch = image[coords[0]-wid:coords[0]+wid+1,coords[1]-wid:coords[1]+wid+1].flatten()
desc.append(patch)
return desc

def match(desc1,desc2,threshold=0.5):
#特征点匹配，使第一幅图中的角点描述子利用归一化相关选取它在第二幅图像的匹配角点
n = len(desc1[0])
#每对点的距离
d = -ones((len(desc1),len(desc2)))
for i in range(len(desc1)):
for j in range(len(desc2)):
d1 = (desc1[i]-mean(desc1[i])) / std(desc1[i])
d2 = (desc2[j]-mean(desc2[j])) / std(desc2[j])
ncc_value = sum(d1 * d2) / (n-1)
if ncc_value &amp;gt;threshold:
d[i,j] = ncc_value
ndx = argsort(-d)
matchscores = ndx[:,0]

return matchscores

def match_twosided(desc1,desc2,threshold=0.5):
#两边对称版本的match
matches_12 = match(desc1,desc2,threshold)
matches_21 = match(desc2,desc1,threshold)

ndx_12 = where(matches_12 &amp;gt; 0)[0]
#去除非对称的匹配
for n in ndx_12:
if matches_21[matches_12[n]]!=n:
matches_12[n] = -1
return matches_12

def appendimages(im1,im2):
#拼接两幅图像
rows1 = im1.shape[0]
rows2 = im2.shape[0]
if rows1 &amp;lt; rows2:
im1 = concatenate((im1,zeros((rows2-rows1,im1.shape[1]))),axis=0)
elif rows1 &amp;gt; rows2:
im2 = concatenate((im2,zeros((rows1-rows2,im2.shape[1]))),axis=0)

return concatenate((im1,im2),axis=1)

def plot_matches(im01,im02,locs1,locs2,matchscores):
#显示一副有连接线的匹配图像
im3 = appendimages(im01,im02)
im4 = vstack((im3,im3))
imshow(im4)

cols1 = im1.shape[1]
rows1 = im1.shape[0]
for i,m in enumerate(matchscores):
if m&amp;gt;0:
plot([locs1[i][1],locs2[m][1]+cols1],[locs1[i][0],locs2[m][0]],&#039;c&#039;)
new_coords =[]
for j in filtered_coords1:
new_coords.append ([j[0] + rows1, j[1]])
for i in filtered_coords2:
new_coords.append ([i[0] + rows1, i[1] + cols1])
plot([p[1] for p in new_coords],[p[0] for p in new_coords],&#039;*&#039;)
axis(&#039;off&#039;)

min_dist = 7
wid = 6
threshold=0.1
im01=array(Image.open(&#039;1.JPG&#039;))
im02=array(Image.open(&#039;2.JPG&#039;))
im1 = array(Image.open(&#039;1.JPG&#039;).convert(&#039;L&#039;))
im2 = array(Image.open(&#039;2.JPG&#039;).convert(&#039;L&#039;))
harrisim = compute_harris_response(im1,5)
filtered_coords1 = get_harris_points(harrisim,min_dist,threshold)
print &#039;Harris Points in 1.JPG:&#039;+bytes(len(filtered_coords1))
d1 = get_descriptors(im1,filtered_coords1,wid)

harrisim = compute_harris_response(im2,5)
filtered_coords2 = get_harris_points(harrisim,min_dist,threshold)
print &#039;Harris Points in 2.JPG:&#039;+bytes(len(filtered_coords2))
d2 = get_descriptors(im2,filtered_coords2,wid)

print &#039;start matching&#039;
matches = match_twosided(d1,d2)
print &#039;Matched Points in 1.JPG and 2.JPG:&#039;+bytes(len(matches))
figure()
gray()
plot_matches(im01,im02,filtered_coords1,filtered_coords2,matches)
show()
</pre>

<p><span style="color: #000000">其中输入图像在python程序的同目录，为两幅近似的图像。其结果一举不同的min_dist和threshold而改变。</span><br><img src="http://7xlk6q.com1.z0.glb.clouddn.com/sift.jpg" alt=""></p>
<p>&nbsp;</p>
<h2 id="py文件打包成-exe可执行文件"><a href="#py文件打包成-exe可执行文件" class="headerlink" title="*.py文件打包成.exe可执行文件"></a><strong>*.py文件打包成.exe可执行文件</strong></h2><p><span style="color: #000000">这里使用的是PyInstaller将py文件打包。实际效果非常方便，会自动搜寻需要的库并合成。可到其<a href="https://pypi.python.org/pypi/PyInstaller/2.1" target="_blank" rel="external">官网</a>下载最新版2.1</span></p>
<p>基本语法是</p>
<pre class="brush: python; gutter: true">python pyinstaller.py [opts] yourprogram.py
</pre>

<p>其中opts是可选项，可加入的参数为：</p>
<pre class="brush: css; gutter: true">-F, –onefile 打包成一个exe文件。
-D, –onedir 创建一个目录，包含exe文件，但会依赖很多文件（默认选项）。
-c, –console, –nowindowed 使用控制台，无界面(默认)
-w, –windowed, –noconsole 使用窗口，无控制台</pre>

<p><span style="color: #ff0000"><strong>BUG</strong></span></p>
<p>这里遇到了恼人的无可药救的无与伦比的bug。其中之一是</p>
<pre class="brush: shell; gutter: true">no module named _ufuncs
</pre>

<p>阅遍无数网页终于在<a href="https://github.com/pyinstaller/pyinstaller/issues/826" target="_blank" rel="external">这里</a>发现了解决方案，需要在PyInstall文件夹的hooks文件夹中添加一个寻找 _ufuncs的py文件。在<a href="https://github.com/pyinstaller/pyinstaller/blob/develop/PyInstaller/hooks/hook-scipy.special._ufuncs.py" target="_blank" rel="external">这里</a> ，命名为hook-scipy.special._ufuncs.py</p>
<pre class="brush: python; gutter: true">#-----------------------------------------------------------------------------
# Copyright (c) 2013, PyInstaller Development Team.
#
# Distributed under the terms of the GNU General Public License with exception
# for distributing bootloader.
#
# The full license is in the file COPYING.txt, distributed with this software.
#-----------------------------------------------------------------------------

# Module scipy.io._ufunc on some other C/C++ extensions.
# The hidden import is necessary for SciPy 0.13+.
# Thanks to dyadkin, see issue #826.
hiddenimports = [&#039;scipy.special._ufuncs_cxx&#039;]</pre>

<p>然后又发现另一个bug，这回是</p>
<pre class="brush: python; gutter: true">no module named integrate</pre>

<p>阅遍无数网页，依然没有结果。。偶然的在需要编译的py文件中加入了一句<br><code>from scipy.integrate import *</code><br>咦居然成功了。。。好吧。结果出来就和在python shell中运行的一样了。可以打包成一整个exe文件，也可以是一个文件夹，包含其他类库的。</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/07/MFC中添加控制台调试/" itemprop="url">
                  MFC中添加控制台调试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-07T02:56:39+08:00" content="2015-05-07">
              2015-05-07
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/" itemprop="url" rel="index">
                    <span itemprop="name">代码狗</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/07/MFC中添加控制台调试/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/07/MFC中添加控制台调试/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #000000">1.在需要添加控制台调试的cpp页面加上<strong>#include “conio.h”;</strong></span></p>
<p><span style="color: #000000">2.在启动mfc窗体的页面加入<strong>AllocConsole();</strong></span></p>
<p><span style="color: #000000">3.在需要输出的地方输入 <strong>cprintf()</strong> ,其中是char类型。若是vs2005之后，应改成_cprintf();</span></p>
<p><span style="color: #000000">4.若需要关闭控制台窗口，使用 FreeConsole();</span></p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/05/[机器学习课程小结][110]/" itemprop="url">
                  [机器学习课程小结][1/10]
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-05T17:29:19+08:00" content="2015-05-05">
              2015-05-05
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/什么都学一下/" itemprop="url" rel="index">
                    <span itemprop="name">什么都学一下</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/什么都学一下/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/05/[机器学习课程小结][110]/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/05/[机器学习课程小结][110]/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1ertx4e3tejj203704bglr.jpg" alt=""><span style="color: #000000">最近在Stanford的网络课程学习了机器学习的课程，Andre Ng讲的灰常不错啊。每种算法对应的实例挺多的，推导也很详细，它基本用matlab实现。就是概率统计数理统计矩阵论方面的知识最近得补一补了，直接应用在编程语言编写某些函数也是挺头疼的，不错还是略有收获。总共20节，听完5节，做个小结。</span></p>
<p><span style="color: #000000">[L1 Introduction]</span><br><span style="color: #000000"> 凸优化理论 隐式马尔科夫模型 O natation 学习型算法</span></p>
<p><span style="color: #000000">1)Supervised Learning</span><br><span style="color: #000000"> 回归问题 Regression 分类问题(x|y)(肿瘤大小|癌症良恶) 学习给定了标准答案的样本-&gt;分析新样本的可能性 支持向量机Support Vector Machine</span><br><span style="color: #000000"> 2)Learning Theory</span><br><span style="color: #000000"> 3)Unsupervised Learning</span><br><span style="color: #000000"> 挖掘 聚类分析-&gt;图像分析和处理的应用 像素处理 ICA Algorithm 鸡尾酒问题（不同声源声音分离）</span><br><span style="color: #000000"> 4)Reinforcement Learning</span><br><span style="color: #000000"> 决策分析</span></p>
<p>&nbsp;</p>
<blockquote>
<p><span style="color: #000000">马可夫过程</span></p>
</blockquote>
<p><span style="color: #000000"> </span></p>
<p><span style="color: #000000">在概率论及统计学中，马可夫过程（英语：Markov process）是一个具备了马可夫性质的随机过程。马可夫过程是不具备记忆特质的（memorylessness）。换言之，马可夫过程的条件概率</span><span style="color: #ff0000">仅仅与系统的当前状态相关，而与它的过去历史或未来状态，都是独立、不相关的</span>。<span style="color: #000000">具备离散状态的马可夫过程，通常被称为马可夫链。马可夫链通常使用离散的时间集合定义，又称离散时间马可夫链。具有马尔可夫性质的过程通常称之为马尔可夫过程。</span></p>
<table style="width: 60%"><br><tbody><br><tr><br><th scope="col"><span style="color: #000000"> </span></th><br><th scope="col"><span style="color: #000000">可数或有限的状态空间</span></th><br><th scope="col"><span style="color: #000000">连续或一般的状态空间</span></th><br></tr><br><tr><br><th scope="row"><span style="color: #000000">离散时间</span></th><br><td><span style="color: #000000">在可数且有限状态空间下的<a style="color: #000000" title="马可夫链">马可夫链</a></span></td><br><td><span style="color: #000000"><a style="color: #000000" title="Harris chain">Harris chain</a> (在一般状态空间下的马可夫链)</span></td><br></tr><br><tr><br><th style="width: 10%" scope="row"><span style="color: #000000">连续时间</span></th><br><td style="width: 25%"><span style="color: #000000"><a style="color: #000000" title="&quot;Continuous-time">Continuous-time Markov process</a></span></td><br><td style="width: 25%"><span style="color: #000000">任何具备马可夫性质的<a class="new" style="color: #000000" title="连续随机过程">连续随机过程</a>，例如<a style="color: #000000" title="维纳过程">维纳过程</a></span></td><br></tr><br></tbody><br></table>

<p>## </p>
<p><span style="color: #000000">具有马尔可夫表示的非马尔可夫过程的例子，例如有移动平均时间序列。最有名的马尔可夫过程为马尔可夫链，但不少其他的过程，包括布朗运动也是马尔可夫过程。</span></p>
<p>&nbsp;</p>
<blockquote>
<p><span style="color: #000000">隐马尔可夫模型</span></p>
</blockquote>
<p>&nbsp;</p>
<p><span style="color: #000000">隐马尔可夫模型（Hidden Markov Model，HMM）是统计模型，它用来描述一个含有隐含未知参数的马尔可夫过程。</span><span style="color: #ff0000">其难点是从可观察的参数中确定该过程的隐含参数</span><span style="color: #000000">。然后利用这些参数来作进一步的分析，例如模式识别。在正常的马尔可夫模型中，状态对于观察者来说是直接可见的。这样状态的转换概率便是全部的参数。而在隐马尔可夫模型中,状态并不是直接可见的，但受状态影响的某些变量则是可见的。</span><span style="color: #ff0000">每一个状态在可能输出的符号上都有一概率分布。因此输出符号的序列能够透露出状态序列的一些信息。</span></p>
<p><span style="color: #000000">隐马尔可夫模型最初是在20世纪60年代后半期Leonard E. Baum和其它一些作者在一系列的统计学论文中描述的。HMM最初的应用之一是开始于20世纪70年代中期的语音识别。 在1980年代后半期，HMM开始应用到生物序列尤其是DNA的分析中。此后，在生物信息学领域HMM逐渐成为一项不可或缺的技术。</span></p>
<p><span style="color: #000000">HMM有三个典型(canonical)问题:</span><br><span style="color: #000000"> 已知模型参数，计算某一特定输出序列的概率.通常使用forward算法解决.</span><br><span style="color: #000000"> 已知模型参数，寻找最可能的能产生某一特定输出序列的隐含状态的序列.通常使用Viterbi算法解决.</span><br><span style="color: #000000"> 已知输出序列，寻找最可能的状态转移以及输出概率.通常使用Baum-Welch算法以及Reversed Viterbi算法解决.</span></p>
<p>&nbsp;</p>
<blockquote>
<p>凸优化</p>
</blockquote>
<p>&nbsp;</p>
<p><span style="color: #000000">凸优化，或叫做凸最优化，凸最小化，是数学最优化的一个子领域，研究</span><span style="color: #ff0000">定义于凸集中的凸函数最小化的问题</span><span style="color: #000000">。凸优化在某种意义上说较一般情形的数学最优化问题要简单，譬如在</span><span style="color: #ff0000">凸优化中局部最优值必定是全局最优值</span>。<span style="color: #000000">凸函数的凸性使得凸分析中的有力工具在最优化问题中得以应用，如次导数等。</span><br><span style="color: #000000"> 凸优化应用于很多学科领域，诸如自动控制系统，信号处理，通讯和网络，电子电路设计，数据分析和建模，统计学(最优化设计），以及金融。在近来运算能力提高和最优化理论发展的背景下，一般的凸优化已经接近简单的线性规划一样直捷易行。许多最优化问题都可以转化成凸优化（凸最小化）问题，例如求凹函数f最大值的问题就等同于求凸函数 -f最小值的问题。</span></p>
<p><span style="color: #000000">凸优化（凸最小化）问题可以用以下几种方法求解：</span><br>捆集法<br><span style="color: #ff0000">次梯度法</span><br><span style="color: #000000">内点法</span></p>
<p><span style="color: #000000">[L2]Linear Regression线性回归 Gradient descent梯度下降 Normal equations正规化方程组（都需要矩阵变换知识）</span></p>
<p><span style="color: #000000">{(x(i), y(i)); i =1, . . . , m}称作包含m个训练样本的训练集合</span></p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93gw1ertvgzf951j20h70czgmk.jpg" alt=""></p>
<p><span style="color: #000000">h是假设的模型，可以带有一定先验知识，也可以是推测类型。学习算法通过学习训练集合的样本，得到h假设中的一定参数，在新的样本中进行预测和他推理</span>。<span style="color: #ff0000">若目标变量y是连续的，则这样的学习问题可归为回归问题；若目标变量y是离散的，例如可在{0,1}中取值的垃圾邮件归类、癌症可能性判定问题，则可归为分类问题。</span></p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93gw1ertvos0ycwj20b803qjri.jpg" alt=""></p>
<p><span style="color: #000000">假设h假设是线性的，则假设就是各个参数线性的代数和。其中θ和x均是向量。x中各向量分量是各自变因素的取值，θ是各个自变量分量的系数或权重。则机器学习算法的目的就是求这个假设函数h(x)与真实值y的最小值。评估标准J(θ)以各样本和预测值的差的平方的二分之一为准。（二分之一纯粹是为了后期的运算）</span></p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93gw1ertvwyw9uwj20en04hq37.jpg" alt=""></p>
<p><span style="color: #000000">1. LMS（<span class="Apple-converted-space"> </span>Least mean square） 算法</span></p>
<p><span style="color: #000000">即最小均方算法。算法实质是自适应的纠错学习，在学习中纠正参数θ的取值，直到收敛。其中，运用的最多的是梯度下降算法（Gradient Descent）</span></p>
<p><span style="color: #000000">算法步骤为：</span></p>
<p><span style="color: #000000">a)选取一个初始参数向量，可令其为0向量</span></p>
<p><span style="color: #000000">b)重复查找各方向梯度，沿着梯度下降最快的方向搜索</span></p>
<p><span style="color: #000000">c)直到四周均比局部梯度大的局部最优点</span></p>
<p><span style="color: #000000">算法的数学描述为（该式为原始式，即梯度下降的数学定义）：</span></p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93gw1ertwxvy7r7j20a503h0st.jpg" alt=""></p>
<p><span style="color: #000000">：=与计算机编程中的赋值语句等同。α称作学习比率。则上式中J(θ)对θ求导的数学推导式为：</span></p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1ertx3pvtwhj20k70aw0ui.jpg" alt=""></p>
<p><span style="color: #000000">这里更新最上式，对于</span><span style="color: #ff0000">单个训练样本 </span></p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1ertxdj12m5j20ef02k0sy.jpg" alt=""></p>
<p><span style="color: #000000">对</span><span style="color: #ff0000">所有训练样本<span style="color: #000000">，沿着梯度方向不断计算直到收敛</span></span></p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1ertxfgsbo8j20jb067mxy.jpg" alt=""></p>
<p><span style="color: #000000">该方法中，每一次梯度的计算都用到了每个训练样本，这种梯度下降的方法称为</span> <span style="color: #ff0000">批梯度下降<span style="color: #000000">。由于这里的最优化问题只有一个全局，因此这里的局部梯度最优点即是全局的梯度最优点。此外还可以采取<span style="color: #ff0000">随机梯度下降</span>，每次梯度的计算选取随机的样本点，这样收敛的速度更快，但可能永远不会收敛到最优点，但会集中在最优点附近。因而在训练样本较大时可以采用随机梯度下降。这是随机梯度下降算法的数学表达：<img src="http://ww2.sinaimg.cn/large/68eb7c93jw1ertxr2dnpkj20pi09omy1.jpg" alt=""></span></span><span style="color: #000000">这是利用批梯度下降算法计算的梯度直到收敛，可以注意到每一次步长是不一样的，步长可在学习中不断调节，越接近最优点步长越短。</span></p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1ertxp6yvc3j20is0ewtb2.jpg" alt=""><span style="color: #000000">2.正规化方程</span></p>
<p><span style="color: #000000">梯度下降是一种求取价值函数J(θ)的方法，正规化方程是另一种方案。首先提到的是几个必要的矩阵知识：</span></p>
<p><span style="color: #000000">f与向量A的映射关系中，对f进行求导的定义：</span></p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1erty55sgncj20x00800v7.jpg" alt=""></p>
<p><span style="color: #000000">关于迹的一些定理：</span></p>
<p><span style="color: #000000">迹的乘法交换：</span></p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1ertychjkpmj20ko03ydgn.jpg" alt=""></p>
<p><span style="color: #000000">迹和转置的迹；迹的加法结合；迹的数乘</span></p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1ertycuu329j20bg05bdg7.jpg" alt=""></p>
<p><span style="color: #000000">迹与倒数相关：</span></p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1ertyf4n67aj20gl080ab4.jpg" alt=""></p>
<p><span style="color: #000000">上式中，B是n_m矩阵，f的定义是依赖m_n矩阵的函数f（A）的值等于AB的迹。其中f（A）中的A的含义是A矩阵的每一个矩阵分量。</span></p>
<p><span style="color: #000000">将J(θ)写成矩阵形式，给定的训练集合定义成矩阵X（m*n）m是训练样本个数，n是每个训练样本的自变量分量。</span></p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1erv2wqwhymj20bt06vt91.jpg" alt=""></p>
<p><span style="color: #000000">则已知的结果也可以用矩阵表示，或者说是向量表示</span></p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1erv2xjw1fgj207e06m0sv.jpg" alt=""></p>
<p><span style="color: #000000">假设h和y的向量差为</span></p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1erv2z16c93j20iw0a33zm.jpg" alt=""></p>
<p><span style="color: #000000">J(θ)则可以表示为：</span></p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1erv2zsi8x8j20mc05qdgh.jpg" alt=""></p>
<p><span style="color: #000000">可以看到，h-y利用了向量内乘的方式，即向量乘以向量的转置，得到的实际上是个一维矩阵即一个数。为了找到J(θ)的最小值，可利用矩阵的求导，并参考上式中迹与倒数相关第三条：</span></p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1erv36i7jh1j20p20dhq5v.jpg" alt=""></p>
<p><span style="color: #000000">第三步骤中，利用到实数的迹也是它本身，第四步中用到了迹和迹的转置，第五步中的方法是利用迹与倒数相关第三条，将A的转置设为θ，B=B的转置=X的转置*X C=单位阵，带入公式即可。令上式为零，则求出导数为零时θ的取值。得到的方程称为正规化方程：</span></p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1erv3chess6j20wy06babl.jpg" alt=""></p>
<blockquote>
<p>梯度下降</p>
</blockquote>
<p><span style="color: #000000">梯度下降法，基于这样的观察：如果实值函数 F(x)在点 (a,f(a)) 处可微且有定义，那么<span style="color: #ff0000">函数 F(x)在 a点沿着梯度相反的方向 -▽ F(a) 下降最快</span>。</span></p>
<p><span style="color: #000000">因而，如果</span><img src="http://upload.wikimedia.org/math/3/f/f/3ff0cdc9fd95f11558270cd4db06ac28.png" alt="\mathbf{b}=\mathbf{a}-\gamma\nabla F(\mathbf{a})"><span style="color: #000000">,对于 <img src="http://upload.wikimedia.org/math/e/2/4/e243b8724ee0860a2b24f48b7c5c2360.png" alt="\gamma&gt;0"> 为一个够小数值时成立，那么 <img src="http://upload.wikimedia.org/math/9/b/b/9bb1b9d10c2499804ac52aaf0aacd8fe.png" alt="F(\mathbf{a})\geq F(\mathbf{b})">。</span></p>
<p><span style="color: #000000">考虑到这一点，我们可以从函数 <img src="http://upload.wikimedia.org/math/8/0/0/800618943025315f869e4e1f09471012.png" alt="F"> 的局部极小值的初始估计 <img src="http://upload.wikimedia.org/math/c/d/5/cd5146b777ca8406c51d8ba8da7fe901.png" alt="\mathbf{x}_0"> 出发，并考虑如下序列 <img src="http://upload.wikimedia.org/math/e/3/6/e36041cdf241095ff7a0e0169a8d405e.png" alt="\mathbf{x}_0, \mathbf{x}_1, \mathbf{x}_2, \dots"> 使得</span></p>
<dl><dd><span style="color: #000000"><img src="http://upload.wikimedia.org/math/8/b/0/8b0e3f1c41429f48f4788cfee9fe57ee.png" alt="\mathbf{x}_{n+1}=\mathbf{x}_n-\gamma_n \nabla F(\mathbf{x}_n),\ n \ge 0."></span></dd></dl>

<p><span style="color: #000000">因此可得到</span><img src="http://upload.wikimedia.org/math/3/e/a/3ea251fcbc5ebc8b22f515e171570797.png" alt="F(\mathbf{x}_0)\ge F(\mathbf{x}_1)\ge F(\mathbf{x}_2)\ge \cdots,">如果顺利的话序列 <img src="http://upload.wikimedia.org/math/c/a/c/cac7a8ab62b2a332af1981678d0504e3.png" alt="(\mathbf{x}_n)"> 收敛到期望的极值。<span style="color: #000000">注意每次迭代_步长_ <img src="http://upload.wikimedia.org/math/3/3/4/334de1ea38b615839e4ee6b65ee1b103.png" alt="\gamma"> 可以改变。假设 <img src="http://upload.wikimedia.org/math/8/0/0/800618943025315f869e4e1f09471012.png" alt="F"> 定义在平面上，并且函数图像是一个碗型。蓝色的曲线是等高线，即函数 <img src="http://upload.wikimedia.org/math/8/0/0/800618943025315f869e4e1f09471012.png" alt="F"> 为常数的集合构成的曲线。红色的箭头指向该点梯度的反方向。（一点处的梯度方向与通过该点的等高线的垂线。沿着梯度_下降_方向，将最终到达碗底，即函数 <img src="http://upload.wikimedia.org/math/8/0/0/800618943025315f869e4e1f09471012.png" alt="F"> 值最小的点。</span></p>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/7/79/Gradient_descent.png/350px-Gradient_descent.png" alt=""></p>
<p>&nbsp;</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/21/cmake-cloudcompare/" itemprop="url">
                  编译CloudCompare
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-04-21T21:31:35+08:00" content="2015-04-21">
              2015-04-21
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/" itemprop="url" rel="index">
                    <span itemprop="name">代码狗</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/21/cmake-cloudcompare/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/21/cmake-cloudcompare/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近有使用到CloudCompare，是一个开源的可视化显示三维点云的程序。<br><a href="http://ww4.sinaimg.cn/large/68eb7c93gw1erdnmdd9qqj202j02sjrc.jpg" target="_blank" rel="external"><img src="http://ww4.sinaimg.cn/large/68eb7c93gw1erdnmdd9qqj202j02sjrc.jpg" alt=""></a></p>
<ul>
<li><a href="http://www.danielgm.net/cc/" title="Cloudcompare项目首页" target="_blank" rel="external">项目首页</a></li>
<li><a href="https://github.com/cloudcompare/trunk" title="git地址" target="_blank" rel="external">Github</a></li>
<li><a href="http://www.cloudcompare.org/doc/wiki/index.php?title=Main_Page" title="wiki" target="_blank" rel="external">wiki</a></li>
</ul>
<p>CloudCompare功能较为丰富，可以处理3d点云数据，可以比较两幅3d点云图像（例如激光扫描获取的图像）亦或者比较一副点云图像和一副三角网。它基于独特的八叉树结构使得性能极大的提升，一般可同时处理超过一千万点云数据，最高可在2Gb的内存下处理1.2亿个点云数据。该软件有可执行文件exe,也可以在linux、mac、windows中编译后使用最新的功能。项目首页有exe、7z版本的完整版、7z简化版的CCviewer，本次编译使用Windows8.1 64bit系统、MS Visual Studio2013 64bit，使用项目的github代码在Cmake下编译。</p>
<p>编译环境：</p>
<ol>
<li><a href="http://www.qt.io/download-open-source/#section-2" target="_blank" rel="external">Qt5.4</a>  Qt中需要下载一个Qt 5.4.1 for Windows 64-bit (VS 2013, OpenGL, 711 MB) (info)来安装Qt的环境，还需要下载一个Visual Studio Add-in 1.2.4 for Qt5 (156 MB) (info)来在VS中进行可视化编辑。</li>
<li><a href="http://www.cmake.org/download/" target="_blank" rel="external">Cmake </a>Cmake是一个根据不同系统和配置进行编译的工具，在windows、linux和mac都可以使用。windows下64位系统可以正常安装32位版本。</li>
<li>利用svn checkoutgithub中的最新项目。这里地址为G:\CCViewer\trunk</li>
</ol>
<p>参考<a href="http://www.cloudcompare.org/doc/wiki/index.php?title=Compilation" title="Compilation" target="_blank" rel="external">这里</a>开始编译：</p>
<p><a href="http://ww2.sinaimg.cn/large/68eb7c93gw1erdnius1ayj20uo0o9qaq.jpg" target="_blank" rel="external"><img src="http://ww2.sinaimg.cn/large/68eb7c93gw1erdnius1ayj20uo0o9qaq.jpg" alt=""></a></p>
<ol>
<li>在编译好的文件G:/build中打开sln，先重新生成解决方案。打不开。参考<a href="http://www.danielgm.net/cc/forum/viewtopic.php?t=992" target="_blank" rel="external">这里</a>，先右键在项目属性中选择debug（编译）将命令那一栏改成debug文件夹下的CloudCompare.exe文件。</li>
<li>最后找不到各种*.dll，在qt的安装文件夹中找到，放到项目的debug文件夹中，若是qcc是完整版，ccviewer是浏览器简版，均是放在相应的debug文件夹下。</li>
</ol>
<p>这样就完成了编译，若需要在vs中编辑qt的窗口，需要在qt的菜单栏选项中指定qt版本和相应的地址，参考<a href="http://www.bogotobogo.com/Qt/Qt5_Visual_Studio_Add_in.php" target="_blank" rel="external">这里</a>，点击Add，写入 版本号5.4.1和地址E:\Qt\Qt5.4.1\msvc2013_64_opengl,这样双击项目中的ui就可以在qt的可视化编辑器中编写qt窗口。。里面的函数封装好复杂，，窝先匿去研究一会儿了。<a href="http://ww4.sinaimg.cn/large/68eb7c93gw1erdl1rx0bpj214e0sj13b.jpg" target="_blank" rel="external"><img src="http://ww4.sinaimg.cn/large/68eb7c93gw1erdl1rx0bpj214e0sj13b.jpg" alt=""></a></p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/03/03/2015-movie-2/" itemprop="url">
                  【电影】【2015】 〇二次点评
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-03-03T21:42:06+08:00" content="2015-03-03">
              2015-03-03
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/槽/" itemprop="url" rel="index">
                    <span itemprop="name">槽</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/03/2015-movie-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/03/2015-movie-2/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>春节档简直是近5年最烂的  国产保护加上喜庆保温 导致所谓最强的影片「狼图腾」也差强人意 主题和细节都没能相当程度上还原原著  更别提钟馗伏魔 澳门风云二这样稀烂的影片了</p>
<p>&nbsp;</p>
<p>「少年时代」</p>
<p>伙伴 陪伴 和自己的成长 这就是最朴素 最大众的少年时代 最写实的美国家庭 姐弟 新朋友 新家庭 新恋情 新的开始 18岁。执着的剧组和执着的男主家庭 用12年撑起了一个自己的纪录片 若要说一些遗憾 便是 少了些许波澜和累点罢 或许生活都这样⭐⭐⭐⭐</p>
<p>&nbsp;</p>
<p>「有一个地方只有我们知道」</p>
<p>文艺老徐 好男人帅哥  穿越时空的爱恋 等一个人 王朔的剧本很婉转 梦一样让人回味 布拉格  老房子 水晶围脖 一封信 老车票 一尊永远在那儿的雕塑 对的人，你是不会失去的。。似青春又纷纷错过 似回忆总记不起  双线结构以老少相遇作为交点  些许落入俗套  吴亦凡王丽坤一类的偶像演员让平静暖心的剧情变得热火朝天 不时耳语尖叫拍凳跺腿  加上布拉格东欧浪漫文艺的风景 让小说剧情电影实实在在成了偶像剧  也罢情人节唯一的爱情剧吧 ⭐⭐⭐⭐</p>
<p>&nbsp;</p>
<p>「狼图腾」</p>
<p>毕竟小说的影响力超过了电影不止一两个数量级，电影也精选了小说的几个重要的节点和精彩桥段 暴风雪夜与狼的决斗 与小狼的故事 刨狼的猎物 构成了电影的主要情节 草原上的故事也相对圆满的完成了人与自然取舍和相处的主旨传递 也成为了春节档独特突出的异类主题 且不谈拍摄草原的艰辛和狼形态的捕捉 单是时间跨度就足以见得设置组的用心 美中不足便是冯的演技还是略微僵硬 ⭐⭐⭐⭐</p>
<p>&nbsp;</p>
<p>「逃离德黑兰」</p>
<p>剧情较为无趣 逃离的拍摄实在有些险峻而超离实际 宣扬大义大勇的拯救公民 以及拯救敌意世界意识形态暴力黑的典型 与刺杀金正恩等都有类似的资本主义潮吹的感慨 既然是得到了西方各大电影节认可的电影 唯一印象深刻的是躲在加国大使馆的美帝人员的紧张和凌乱变现的异常出彩 相比是比较中庸而符合G点的⭐⭐⭐</p>
<p>&nbsp;</p>
<p>「天将雄师」</p>
<p>各种混搭各种奇葩 中西合璧的成龙大哥和 乱入的朱孝天崔始源 还有捧哏和逗哏的筷子兄弟 就这样奇葩的馅料居然还捏成了不错的饺子 大汉天国终于和古罗马骑兵来了一次穿越搏击和惺惺相惜 龙哥的光环强的无限续命 主角以开头就注定了死掉的命运 好惨的是死的还这么简单 但作为毫无特效的古装漠片能紧扣剧情一气呵成也不容易 给春节档一个惊喜⭐⭐⭐⭐</p>
<p>&nbsp;</p>
<p>「澳门风云2」</p>
<p>不多谈 粤式无厘头笑点 无3d的3d片 春节呵呵不起来的嘻嘻档 烂 ⭐⭐</p>
<p>「一路惊喜」</p>
<p>虽然格调挺俗的 虽然演员挺作的 虽然情节挺狗血的 但是我居然感到了一丝暖意 挺好 ⭐⭐⭐⭐</p>
<p>&nbsp;</p>
<p>「模仿游戏」</p>
<p>看点除了卷福的超群演技外 似乎并没什么深刻人心的 没有残酷的谍战 没有缜密的逻辑推理和演绎 没有繁复的破解技巧和战争胜利的重要性 只有时间段的跳跃 被基佬利用的爱情 和实验室（算是在做实验吧 和一大群基佬们的斗智斗勇和最后争夺经费和战略隐瞒的剧情冲突 但这就正是电影节电影的思路 對基佬對打擊 對戰爭勝利至高重要性對年代 對人性大義對褒獎 都是獲得普遍認可的重要原因 ⭐⭐⭐⭐</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/01/2015-movie-1/" itemprop="url">
                  【电影】【2015】〇一次点评
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-01T04:07:13+08:00" content="2015-02-01">
              2015-02-01
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/槽/" itemprop="url" rel="index">
                    <span itemprop="name">槽</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/01/2015-movie-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/01/2015-movie-1/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近闲的慌 拔草了许多电影 有当下上映的 也有各种高分&nbsp;&nbsp;【重返20岁】</p>
<p><a href="http://ww3.sinaimg.cn/large/68eb7c93gw1eotcq3l0l9j21kw16o13e.jpg" target="_blank" rel="external"><img src="http://ww3.sinaimg.cn/large/68eb7c93gw1eotcq3l0l9j21kw16o13e.jpg" alt=""></a><br>尽管是中文版【奇怪的她】 对白和情节上也不仅相似 但是剧情在中国化的喜剧氛围后 在幽默之余更加动人 讲述了60岁老太太进入青春照相馆穿越回20岁重回亲朋身边的逗趣温馨故事 &nbsp;贴近百姓人心的穿越让本显得平庸的幻想片令人动容 婆媳关系 婆婆的唠叨 祖辈对晚辈的疼爱 都和中国家庭的生活息息相关应该是举家都适合观看的好电影 推荐 ★★★★★</p>
<p>&nbsp;【博物馆奇妙夜3】</p>
<p><a href="http://ww3.sinaimg.cn/large/68eb7c93gw1eotbmtz5rxj21kw16othr.jpg" target="_blank" rel="external"><img src="http://ww3.sinaimg.cn/large/68eb7c93gw1eotbmtz5rxj21kw16othr.jpg" alt=""></a>个人感觉这样的穿越就显得有些苍白 尽管秉承了1和2的故事串联和笑点 但是终归只能作为商业喜剧 凭借着一流的但却不入流的特效展示和脸谱化的人物和动物 使得笑点单调不具深意 终归是围绕着如何防止一块会褪色的石头褪色的故事展开 在大英博物馆碰到各种大变活人的化石疯跑了好几圈终于找到咪咪的俗套剧情 重口的爱情 木乃伊一家的温情 仅仅是难得的喜剧之外的意外 不推荐&nbsp;★★★</p>
<p>&nbsp;&nbsp;</p>
<p>【辩护人】</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93gw1eotbu6095ej211y0lcwkg.jpg" alt=""></p>
<p>韩国电影最近经常入我的眼球 除了一贯的感情戏让人缠绵得撕心裂肺 更高的立意也是值得国产电影学习的地方 辩护人类似的主题若是在国内上映应该是冷处理禁播状态 结社游行反共主义 都是大忌讳 更甚的是提到了民主主义 权力交给人民 法律真正能凌驾于人制之上 从微观一个发际的律师心态的变化 到宏观上整个社会的响应整个律师界的声援 充满了正义（敢于与政府抵触）和正气 我宁愿相信学生是社会的源动力 科技的变革 政治和思潮的涌动 都是从底层接受教育感受最清澈的思维发出的 社会是个大熔炉 不进去不知道疾苦 但是进去了也便只晓得尝到疾苦了 剧中律师和家人的纠结 律师和阿玛的纠结 律师和法官和原告的纠结 都影射了整个社会的人际关系和人情来往对法制的影响 无论社会主义资本主义 暴力机关大抵上都是为了统治阶级服务的 但是能发声 能自由的发声 能自由的不加掩饰的发声 也便只有某些地方 才有罢 推荐★★★★★&nbsp;</p>
<p>&nbsp;【布达佩斯大饭店】<br><a href="http://ww2.sinaimg.cn/large/68eb7c93gw1eoud0ihps8j211y0lcwkg.jpg" target="_blank" rel="external"><img src="http://ww2.sinaimg.cn/large/68eb7c93gw1eoud0ihps8j211y0lcwkg.jpg" alt=""></a><br>据传2014年奥斯卡就炒鸡火了今年又被捧红了 文艺到醉 拼接章节式的小段故事一般 娓娓道来 层层递进 把越狱 偷画 偷腥 逃亡表现的如此的幽默 但又不失结构感 尽管脸谱化过重了一些但是人物表现的张力十足 要强有能力的门童 广结人缘唠叨满腹又一路坎坷的酒店主管 冷酷的杀手 可爱懵懂为爱奋不顾身的女孩 极致的展现了导演的造化功力 推荐★★★★★</p>
<p>&nbsp;【恐怖直播】&nbsp;</p>
<p>韩国独特角度和独特风格的电影 特爱把主角从内心到外表抓狂捉急焦虑挣扎各种心理状态细微刻画 又是一场 针对国家针对政府层面的立意 最近几部看到的韩国高分电影都带有政治色彩 这一步甚是左派风格 毅然决然的在绝望的时候化身成了恐怖分子 这样的延伸在国内甚至可能成为民族主义 民粹主义分裂人民和国家的借口 因为值得深思的是国家尊严和个人尊严冲突时的应激处理方式 自我价值和他人价值联系融和时生命取舍的价值观对待问题 诚然 身处电影的灾难时 我也不清楚会不会暴力的变成一个为了自证而自我毁灭恐怖分子 ★★★★&nbsp;</p>
<p>【素媛】</p>
<p>&nbsp;超棒暖人心的电影 情节有些虐  在火车上本以为是个故事剧情 居然在被窝里看哭了 韩国的心理戏真是让人赞 超离了父母的爱外依旧心系整个国家整个社会的法制正义 推荐★★★★★&nbsp;</p>
<p>【疯狂原始人】&nbsp;</p>
<p>米帝梦工厂动画始终如一的剧情和特效完美结合 加上些许或勇气或希望或爱情的立意 搭配完美结局 整合成套的美国动画标准制作 些许欢乐些许感人 讲述了原始人老爹不愿接触新事物到勇于探索新天地的历程 ★★★★&nbsp;</p>
<p>【霍比特人3-五军之战】</p>
<p>&nbsp;没有资格评价 过于复杂的家族关系和世界观 但相比霍比特人1睡着了的我已经充满斗志的看完了 抛开剧情设置而言 对覆灭濒临崩溃的军队的描绘并没有让人看到绝望或者惨痛 而主角们过于单一化的主线进入单挑模式也不让人有更多现象空间 面对黄金魔咒而挣脱出来的索林也显得有些唐突 最出彩的怂蛋却压制了主角的人物化性格 战争格斗场面甚至想起了早些年的一些国产历史剧 特效不太值得imax 只有颜值影迷和故事系列影迷能够如此深邃的看下去罢 ★★★★&nbsp;</p>
<p>【无人区】&nbsp;</p>
<p>人只有在群居时才是人类 给独特的视角和故事结构赞 主角光环有些过于负重了 血腥暴力可以再更贴近实际 但一切的黑暗和光明都已很出彩 推荐★★★★★</p>
<p>&nbsp;【消失的爱人】</p>
<p>&nbsp;剧情反转以至于电影的类型都突然翻转 本以为是黄赌毒的温情片 结果意想不到的确是恐怖剧情悬疑片 女主有高圆圆那种独特的大方而温柔的美 我要是男主都被吓傻了 这妞完全没法hold 各大影评好评到爆 目测奥斯卡有一些收获 不过本应生活的太过跳跃了★★★★&nbsp;</p>
<p>【智取威虎山】&nbsp;</p>
<p>难得的国产战争片一气呵成的2个多小时 尽管任务化妆和服装都略假 但剧情层层深入以及反派的桀骜残暴性格给加分不少 其中少数土匪的幽默细胞和土匪帮派的对话、组织、反间等特殊场景成为亮点 最后的特性也十分酷炫 作为红色电影能有如此震撼而连贯的气质徐克展现不俗实力 推荐★★★★★ &nbsp; &nbsp;</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/29/2014生活生命、/" itemprop="url">
                  [2014]生活生命、
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-01-29T00:42:10+08:00" content="2015-01-29">
              2015-01-29
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/槽/" itemprop="url" rel="index">
                    <span itemprop="name">槽</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/01/29/2014生活生命、/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/29/2014生活生命、/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014亦算是个重要节点。考研了。复试了。毕业了。喝醉了。一切都这么顺利，顺利得很平静。狂欢中带走离别，夹杂着不少的噪音。世界杯让我忘了自己，撞上了树状。自以为满心得意的DIP，睡过了。怪不了谁，谁都不应该为我负责，22岁，一个复杂的年龄。</p>
<p>或许该是成长到成熟这个节点了。一个人一年，走了至今最多的城市，<strong>武汉 北京 天津 绍兴 杭州  桐乡乌镇 嘉善西塘 吴江同里 苏州 无锡 扬州 长沙 张家界 成都 都江堰 川主寺黄龙 九寨沟 若尔盖花湖 乐山 重庆 南宁 大同 介休 太原 平遥 鄂尔多斯 达拉特旗 包头 呼和浩特 </strong>。一个人一年，看了至今最多的书，尽管都是学术和科研，但终归是目测达到了智商的巅峰，无论数理逻辑还是语言学习，都未曾来过的顶峰。一个人一年，看过了至今最多的电影，学会了沉溺，更学会了跳跃和放弃，不再执着于影评，不再执着于类别，看的就是当下的心情 。一个人一年，习惯了抬头看星星，低头碰杯饮，吃了至今最多的零食，喝了至今最多的酒，吐了至今最多的槽。我有一个常煮面的锅，我有一个可以经常打羽毛球的伴，我有一个听李荣浩的音箱，我变得有些孤僻，但时而放荡得不着边际。更爱笑也学会了哭，面对恐惧却不自觉的冷静得冷酷，面对压力从容得像未曾来过。我学着独自承受，学着享受提供的起起伏伏，学着把握每一时刻的心跳。平淡里最显唐突的就是离别，但是把酒言欢，抑或酒吧，抑或桌游，抑或聚餐，都是无懈可击的欢乐筵席。有泪水，却不带苦涩。有倾斜，却毫无酸楚。我们珍重这说着的是永恒的朋友，唱着这一次又一次骊歌。</p>
<p>&nbsp;</p>
<p>我却爱逃避。逃避挥手。逃避责任。逃避胆怯。用放纵来表达着怂。</p>
<p>&nbsp;</p>
<p>2015.<strong>不怂</strong>。</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/15/SublimeText添加中文编码/" itemprop="url">
                  SublimeText添加中文编码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-15T19:10:49+08:00" content="2014-12-15">
              2014-12-15
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/" itemprop="url" rel="index">
                    <span itemprop="name">代码狗</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/12/15/SublimeText添加中文编码/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/12/15/SublimeText添加中文编码/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>SublimeText添加中文编码</p>
<ol>
<li>Preferences”–&gt;“Package Control</li>
<li>在输入框内输入“Install Package”，点击下方自动提示出来的“Install Package”</li>
<li>弹出一个输入框内输入“CovertToUTF8”，下面就会相应的插件，鼠标点击安装。</li>
<li>稍等几秒后，插件就会安装成功，无需重启Sublime Text,中文内容已经能够正确显示了。</li>
</ol>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/12/Hadoop2.2.0 Mapreduce Log日志分析小例/" itemprop="url">
                  Hadoop2.2.0 Mapreduce Log日志分析小例
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-12T02:17:26+08:00" content="2014-12-12">
              2014-12-12
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/" itemprop="url" rel="index">
                    <span itemprop="name">代码狗</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/代码狗/学习log/" itemprop="url" rel="index">
                    <span itemprop="name">学习log</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/12/12/Hadoop2.2.0 Mapreduce Log日志分析小例/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/12/12/Hadoop2.2.0 Mapreduce Log日志分析小例/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这个任务主要是在搭建好Hadoop2.2.0环境的基础上，模仿sample中的wordcount程序，手动编写一个Mapreduce的对日志文件分析的函数。该日志文件是模拟搜索引擎记录所有用户的查询，当有一个用户使用搜索引擎进行搜索时，日志文件会记录这样一条记录：（搜索时间、搜索关键字、用户IP）。其中，日志文件的格式是：</p>
<ul>
<li>时间+搜索词+IP地址</li>
<li>2011-10-26 06:11:35 云计算 210.77.23.12</li>
<li>2011-10-26 06:11:45 Hadoop 210.77.23.12</li>
</ul>
<p>利用Mapreduce模型对日志文件进行分析，需要完成的任务有：</p>
<ul>
<li>所有日志中出现次数最多的50个关键词；</li>
<li>特定日期区间日志中出现次数最多的50个关键词；</li>
<li>特定IP地址区间（假定前3段相同，区间在4段中设定）日志中出现次数最多的50个关键词</li>
</ul>
<p>任务主要流程包括：</p>
<ul>
<li>按照一定的规则随机生成并将日志文件写入DFS中。</li>
<li>将日志文件进行字符串筛检，提取出所需字段并计数</li>
<li>将累计的词数进行排序</li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en69s477ktj20fc0atdge.jpg" alt=""></p>
<p>编程之前，研究了一下eclipse-hadoop的插件，其作用是可以快速的查看DFS中的新增的文件，即写入日志，生成日志都能快速的查看。下载jar包，将之放到eclipse目录下的dropins里。启动eclipse后再preference里可以配置hadoop的路径。</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en69y207dij20hm055dga.jpg" alt=""></p>
<p>在导航中打开map-reduce的窗口，右键新建一个HadoopLocation，如图：</p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1en69yxctfuj20s20enq5z.jpg" alt="">        这里Mapreduce和DFS的port分别是mapred-site.Xml和core-site.xml中配置的端口。这样就可以在Program Explorer 中看到dfs的文件。</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en69zmtefxj205v04e3yj.jpg" alt="">此外，加入了插件后还可以直接建立Mapreduce的项目，这里就不详述了。</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6a08tm2hj20gz09174x.jpg" alt=""><br>变成之前对Hadoop2.2.0的Mapreduce做一个简介。之前版本的Mapreduce是由Jobtracker和TaskTracker来管理的，之后出现了Yarn模型的版本，其要义是优化了每次Job都要经过JobTracker分配的结构，通过NodeManager管理节点任务，通过ResourceManager管理资源的分配。</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6a10wwoxj20cv09ogme.jpg" alt=""></p>
<p>该系统程序的编写建立在系统自带的Wordcount demon上，通过重写Mapper类下的Map函数和Reducer类下的Reduce函数来读入分布式文件的数据，并进行分布式处理。其中，排序并找出前K个任务由两个Mapreduce完成。第一个任务Map负责读取分布式文件，截取字符串，并按任务需求过滤log信息；第一个任务Reduce负责对截取出的搜索词计数。第二个任务的Map负责封装新的词频和搜索词；第二个任务的Reduce负责将K-V键值对加入TreeMap并进行排序，最终输出TopK文件。<br>操作者需要在一台配置好Hadoop的Linux全分布式节点的环境下，在控制台通过hdfs命令输入7项参数（其中5项必选）：1.输入log日志文本路径 2.第一个Mapreduce输出的词频统计文件路径 3.第二个Mapreduce输出的词频统计顺序排列的文件路径（中间过程）4.第二个Mapreduce输出的最高词频统计结果的文件路径 5.任务需求 6.参数1 7.参数2 进行系统的操作，最终在在hdfs文件系统中找到生成的结果，一般以ABC-part-00000命名。参数输入错误或者系统崩溃会自动停止程序。</p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1en6a20gi08j20o20bwmxy.jpg" alt=""></p>
<p>之前叙述了系统由两部分构成，其中第一部分不作为系统的主体框架，只作为普通JavaApplication处理，另一部分则具体分为MAP1，REDUCE1,MAP2,REDUCE2来处理，以下是系统设计的具体框架。<br>第一部分较简单，通过调用Hadoop写入文件的API，再加上随机函数分别生成搜索词、IP和日期来实现。第二部分则通过编写两个函数入口run、两个map读取文件和两个reduce实现相应功能来组成。本系统的主要类如下：</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6a3grqz1j2055053jrl.jpg" alt=""></p>
<p>其中，Config主要存放系统全局的参数，例如日志行数，日志起止时间，topK个数等。<br>DFSWritter负责第一个主要任务写入数据，包含以下函数：</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6a4d8g9pj205902cq2w.jpg" alt=""></p>
<p>写入数据构成如下：</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6a51ij4xj20sr080q3h.jpg" alt=""></p>
<p>其中获取随机日期的getRandomDate函数，其中在config中指定各参数</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6a5w98dvj20ke07fgn5.jpg" alt=""></p>
<p>获取随机搜索词的函数，其中Config可以配置搜索词最短和最长词数。</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6a6p3he8j20nw07l0u9.jpg" alt=""></p>
<p>获取随机IP的函数，其中IP最大最小值可在config中指定。</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6a7e0i34j20ne04j0tc.jpg" alt=""></p>
<p>Writter函数，负责写入log数据，已指定了写入的路径。<br><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6a856bgrj20i80eatbf.jpg" alt=""></p>
<p>在main调用写入函数即可。第二个任务是进行日志文件的筛查、排序、查找最大值。主要用到的类有：</p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1en6a9b6vr0j204w03a74d.jpg" alt=""></p>
<p>LogAnalysiser21、LogAnalysiser21分别负责第一个、第二个Job的入口，继承了Configured类，实现配置Map和Reduce，若有Combiner或者partitioner也在这里进行配置。它们均重写了run函数进行mapreduce的启动。二者可以合并，这里分开让结构更清晰。<br>MapClass MapClass2分别是两个job的映射，读取输入的文件并传给Reduce。它们均继承自Mapper并重写map函数。<br>ReduceClass ReduceClass2 分别是两个Job的处理细节，收到来自Map的信息并作整合处理。它们均继承自Reducer并重写reduce函数。<br>如下图是该任务的系统流程：</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6aa7zbrjj20n60c8409.jpg" alt=""></p>
<p>其中logAnalysis21负责对参数中mode进行判断，加载第一个job，主要函数run’为：</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6aapphpij20qz0byq4p.jpg" alt=""></p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6ab82ey0j20eg05yt9u.jpg" alt=""></p>
<p>MapClass中map函数如下，主要负责依据不同的需求对日志文件进行筛选</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6ac19sqjj20js0ct418.jpg" alt=""></p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6acnbc0lj20k109djt9.jpg" alt=""></p>
<p>ReduceClass 中reduce函数如下，主要负责计数并输出。</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6ad4qxadj20jg04daap.jpg" alt=""></p>
<p>LogAnalysis22负责加载第二个job，run函数如下：</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6ady0bw1j20o20dydjd.jpg" alt=""></p>
<p>MapClass2负责读取上一个job的wordcount文件，并对数据键值对进行改写，将词频改写为填充到10位的long，由于排序时同词频会被删除，因此将key改写为（词频+搜索词）value改写为（搜索词） 。Map函数如下：</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6aexl5nyj20o1039dgl.jpg" alt=""></p>
<p>Reduce2负责读取传来的键值对，写入TreeMap，利用TreeMap的排序器自动对传来的改写（搜索词+词频）进行排序。这里用到了TreeMap自动根据key值进行排序的方法，但是key不能重复，因此在Map中改写起到了作用。同时，这里重写了TreeMap的Comparator函数，默认依据是从小到大排序。若指定了排序器Comparator，这里就可以按照从达到小进行排序了。排序完成后截取key前10位即为词频，value即为搜索词。Reduce函数主要如下：</p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1en6affldqej20lv0dnjto.jpg" alt=""></p>
<p>这里context输出只是中间结果sort，需要找到前N个高频搜索词，因此指定新的输出：</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6afzezfbj20ix0720u3.jpg" alt=""></p>
<p>在安装配置好hadoop的分布式系统启动hadoop：</p>
<p>&nbsp;</p>
<pre class="brush: bash; gutter: true">./start-dfs.sh ./start-yarn.sh</pre>

<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6b2rf3ndj20hz05at9r.jpg" alt=""></p>
<p>在Config.java确认配置参数</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6b3i6ungj207g07qmya.jpg" alt=""></p>
<p>运行DFSWritter.java文件，将日志写入HDFS分布式文件系统，这里写入50个作为测试。</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6b41kibtj20ci01vdfx.jpg" alt=""></p>
<p>输入hdf格式的命令，先列出log日志的结果</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6b4i2mh6j20cn0cvgnt.jpg" alt=""></p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6b4wispqj20990bg0uy.jpg" alt=""></p>
<p>将Java程序导出成JAR到本地路径/usr/workspace/jar/logAnalysis2.0.jar。</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6b5hlroyj20h709bgmn.jpg" alt=""></p>
<p>在命令行hdf命令，并带上必要的参数。首先运行需求一</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6b6bmiaoj20i101y74m.jpg" alt=""></p>
<p>两个Mapreduce一气呵成完成，分别查看wordcount\sort\topK,<br>查看Wordcount，可以看到按需统计的词频</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6b6um7e7j20hy0buq49.jpg" alt=""></p>
<p>查看sort，其中大的值排在了最后。</p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1en6b7psqyhj20fx0bv3yt.jpg" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1en6b84efm9j203x0ad749.jpg" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>最后查看topK结果，即截取了sort的最后的8项并倒序输入。</p>
<p><img src="http://ww4.sinaimg.cn/large/68eb7c93jw1en6b9u4yjyj20hp06o3z6.jpg" alt=""></p>
<p>运行第二个需求，在参数五中输入2，并写上起止IP</p>
<p><img src="http://ww3.sinaimg.cn/large/68eb7c93jw1en6bad6w83j20i301474g.jpg" alt=""></p>
<p>运行结果的wordcount、sort、topK文件分别如下</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6bb6k4j8j20gg0a2mxn.jpg" alt=""></p>
<p>最后运行第三个需求，参数中带入3 和起止时间。</p>
<p><img src="http://ww1.sinaimg.cn/large/68eb7c93jw1en6bbm6hi0j20i101k74j.jpg" alt=""></p>
<p>再次分别查看wordcount sort topk文件，比对前文的全log发现完全符合。</p>
<p><img src="http://ww2.sinaimg.cn/large/68eb7c93jw1en6bcbhaifj20fi0cxmxr.jpg" alt=""></p>
<p>这样，一个建立在Hadoop的Mapreduce小例就完成了。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/xiaozaizi.png" alt="Jay Wang">
          <p class="site-author-name" itemprop="name">Jay Wang</p>
          <p class="site-description motion-element" itemprop="description">你猜?</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">107</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">62</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ovjaywang" target="_blank" title="GitHub">
                  
                    <i class="fa fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/302060345" target="_blank" title="Weibo">
                  
                    <i class="fa fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/ov_beeshoot" target="_blank" title="douban">
                  
                    <i class="fa fa-globe"></i>
                  
                  douban
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.instagram.com/ohahabienaola" target="_blank" title="Instagram">
                  
                    <i class="fa fa-instagram"></i>
                  
                  Instagram
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://plus.google.com/112912013380614886638" target="_blank" title="Google">
                  
                    <i class="fa fa-google"></i>
                  
                  Google
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  <% if (page.mathjax){ %> <%- partial('plugin/mathjax') %> <% } %> 
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jay Wang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/ven/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/ven/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/ven/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/ven/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/ven/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/ven/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"mimimomo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax --><!-- hexo-inject:end -->


</body>
</html>